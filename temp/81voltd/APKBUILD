# Temporarily packaged until upstreamed in ModemManager
# See 5f68d244520c942f35cc780f61cee970ac80e60d
pkgname=81voltd
pkgver=1.1.0
pkgrel=0
pkgdesc="Server-side implementation of the QMI IMS Data service"
url="https://gitlab.com/flamingradian/81voltd"
arch="all"
license="GPL-2.0-or-later"
makedepends="
	modemmanager-dev
	qrtr-dev
	libqmi-dev
	meson
	qmi-utils
	"
source="
	$pkgname-$pkgver.tar.gz::https://gitlab.postmarketos.org/modem/$pkgname/-/archive/v$pkgver/$pkgname-v$pkgver.tar.gz
	81voltd.initd
	81voltd.service
	"
builddir="$srcdir/$pkgname-v$pkgver"
subpackages="$pkgname-openrc $pkgname-systemd $pkgname-doc"

# There are no checks to run
options="!check"

build() {
        abuild-meson . output
        meson compile -C output
}

package() {
	DESTDIR="$pkgdir" meson install --no-rebuild -C output

	install -Dm755 "$builddir"/output/81voltd "$pkgdir"/usr/bin/81voltd
	install -Dm755 "$srcdir"/81voltd.initd "$pkgdir"/etc/init.d/81voltd

	install -Dm644 "$srcdir"/81voltd.service -t "$pkgdir"/usr/lib/systemd/system
}

sha512sums="
20a48208ed59078ce45942d81b01ebe55480e5078d2ccc8504cf85b9fd8ff2a13b081df59df227d6d8d37c57090149de71b6988ad02821a2db130de6b79b3f61  81voltd-1.1.0.tar.gz
73fa6f27259f3731a811216983911886e4ce5fb15664f978e99184ab88fd4444142f72b6313474e59260596a54e8e3ace7b66f10ead92159fad930b3a225b464  81voltd.initd
2b3f0b2fb03b0c1e21edd1f9e29ea4e5d4ca0d4110ed890c847b4098ac8175c7a77e1f1868d799f1e00010f67539f2bc1d143521847aaacbea882db4d7b199a1  81voltd.service
"
