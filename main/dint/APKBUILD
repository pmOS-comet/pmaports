# Maintainer: Stefan Hansson <newbyte@postmarketos.org>
pkgname=dint
pkgver=0.0.1_git20250925
pkgrel=0
pkgdesc="postmarketOS deviceinfo validator and linter"
url="https://gitlab.postmarketos.org/Newbyte/dint"
# armhf, armv7, riscv64: cpufeatures crate fails to build with --frozen specified
arch="all !armhf !armv7 !riscv64"
license="EUPL-1.2"
makedepends="cargo cargo-auditable"
_commit="1f8c0949268c2d31a2e50cb3ac6793fdb4a4c92c"
source="https://gitlab.postmarketos.org/Newbyte/dint/-/archive/$_commit/hello-world-rust-$_commit.tar.bz2"
builddir="$srcdir/dint-$_commit"

prepare() {
	default_prepare

	cargo fetch --target="$CTARGET" --locked
}

build() {
	cargo auditable build --release --frozen
}

check() {
	cargo test --frozen
}

package() {
	install -Dm755 target/release/dint \
		-t "$pkgdir"/usr/bin
	install -Dm644 deviceinfo_schema.toml \
		-t "$pkgdir"/usr/share/dint
}

sha512sums="
a94dba58220c4fbff83b64ff761849d84b7f6fd8aa5d49bd4756dad964b9489abc8884021307801886fc974ba8bcfba931635ee8ab4eb34854727640c64546cc  hello-world-rust-1f8c0949268c2d31a2e50cb3ac6793fdb4a4c92c.tar.bz2
"
