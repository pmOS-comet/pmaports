pkgname=firmware-mecha-comet-m
pkgver=1
pkgrel=1
_fw_ver="pmos-devel-6.6.52-20251023"
pkgdesc="Firmware for the Mecha Comet M"
url="https://github.com/Ersa-Studios/linux-mecha-firmware"
arch="aarch64"
license="proprietary"
options="!check !strip !archcheck !tracedeps pmb:cross-native"
source="linux-mecha-firmware.tar.gz::$url/archive/refs/tags/$_fw_ver.tar.gz"
builddir="$srcdir/linux-mecha-firmware-$_fw_ver"

package() {
	mkdir -p "$pkgdir/lib/firmware/postmarketos"

	# Broadcom firmware
	install -Dm644 "$builddir/firmware/brcm/BCM4345C0.1MW.hcd" \
		"$pkgdir"/lib/firmware/postmarketos/BCM4345C0.1MW.hcd
	install -Dm644 "$builddir/firmware/brcm/brcmfmac43455-sdio.bin" \
                "$pkgdir"/lib/firmware/postmarketos/brcm/brcmfmac43455-sdio.bin
	install -Dm644 "$builddir/firmware/brcm/brcmfmac43455-sdio.bin"	\
		"$pkgdir"/lib/firmware/postmarketos/brcm/brcmfmac43455-sdio.fsl,imx8mm-evk.bin
	install -Dm644 "$builddir/firmware/brcm/brcmfmac43455-sdio.txt" \
                "$pkgdir"/lib/firmware/postmarketos/brcm/brcmfmac43455-sdio.fsl,imx8mm-evk.txt
	install -Dm644 "$builddir/firmware/brcm/brcmfmac43455-sdio.clm_blob" \
                "$pkgdir"/lib/firmware/postmarketos/brcm/brcmfmac43455-sdio.fsl,imx8mm-evk.clm_blob
        install -Dm644 "$builddir/firmware/brcm/brcmfmac43455-sdio.clm_blob" \
                "$pkgdir"/lib/firmware/postmarketos/brcm/brcmfmac43455-sdio.fsl,imx8mm-evk.clm_blob

	# Regulatory Databases
	install -Dm644 "$builddir/firmware/brcm/regulatory.db" \
		"$pkgdir"/lib/firmware/postmarketos/brcm/regulatory.db
	install -Dm644 "$builddir/firmware/brcm/regulatory.db.p7s" \ 
                "$pkgdir"/lib/firmware/postmarketos/brcm/regulatory.db.p7s

	# NXP firmware
	cp -r "$builddir/firmware/nxp" "$pkgdir/lib/firmware/postmarketos"

	# IMX SDMA - unused right now
	# cp -r "$builddir/firmware/imx" "$pkgdir/lib/firmware/postmarketos"

	# HDA firmware
	cp -r "$builddir/firmware/skl_hda_dsp_generic-tplg.bin" "$pkgdir/lib/firmware/postmarketos"
}

sha512sums="
399dc16aad7c1cb09cc0da1c324fcc38580488952fba368b97d33ed577a29be53ed3d4d9dcacbd4c8368cb7e5e97fc771779a1f68b73c1e4723a83ff0f22dd57  linux-mecha-firmware.tar.gz
"
