pkgname=firmware-mecha-comet-m
pkgver=1
pkgrel=1
_fw_ver="pmos-devel-6.6.52-20251023"
pkgdesc="Firmware for the Mecha Comet M"
url="https://github.com/Ersa-Studios/linux-mecha-firmware"
arch="aarch64"
license="proprietary"
options="!check !strip !archcheck !tracedeps pmb:cross-native"
source="linux-mecha-firmware.tar.gz::$url/archive/refs/tags/$_fw_ver.tar.gz"
builddir="$srcdir/linux-mecha-firmware-$_fw_ver"

package() {
	mkdir -p "$pkgdir/lib/firmware/postmarketos"

	echo "Installing Broadcom firmware"
	# Broadcom firmware
	cp -r "$builddir/firmware/brcm" "$pkgdir/lib/firmware/postmarketos"

	echo "Installing NXP firmware"
	# NXP firmware
	cp -r "$builddir/firmware/nxp" "$pkgdir/lib/firmware/postmarketos"

	# IMX SDMA - unused right now
	# cp -r "$builddir/firmware/imx" "$pkgdir/lib/firmware/postmarketos"

	# HDA firmware
	echo "Installing HDA firmware"
	install -Dm644 "$builddir/firmware/skl_hda_dsp_generic-tplg.bin" \
		"$pkgdir"/lib/firmware/postmarketos/skl_hda_dsp_generic-tplg.bin

	echo "Done"
}

sha512sums="
399dc16aad7c1cb09cc0da1c324fcc38580488952fba368b97d33ed577a29be53ed3d4d9dcacbd4c8368cb7e5e97fc771779a1f68b73c1e4723a83ff0f22dd57  linux-mecha-firmware.tar.gz
"
