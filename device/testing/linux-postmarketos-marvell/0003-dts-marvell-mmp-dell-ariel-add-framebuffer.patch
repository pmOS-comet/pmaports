From ded0c6d4a82eea2e616730500c7d889df76c4bc8 Mon Sep 17 00:00:00 2001
From: Robert Eckelmann <longnoserob@gmail.com>
Date: Fri, 26 Dec 2025 15:41:14 +0900
Subject: [PATCH 3/3] dts/marvell/mmp-dell-ariel: add framebuffer

Signed-off-by: Robert Eckelmann <longnoserob@gmail.com>
---
 arch/arm/boot/dts/marvell/mmp3-dell-ariel.dts | 135 +++++++++++++++---
 arch/arm/boot/dts/marvell/mmp3.dtsi           |  18 +--
 2 files changed, 122 insertions(+), 31 deletions(-)

diff --git a/arch/arm/boot/dts/marvell/mmp3-dell-ariel.dts b/arch/arm/boot/dts/marvell/mmp3-dell-ariel.dts
index 28a67cc8976c..7fb59f90a399 100644
--- a/arch/arm/boot/dts/marvell/mmp3-dell-ariel.dts
+++ b/arch/arm/boot/dts/marvell/mmp3-dell-ariel.dts
@@ -8,6 +8,7 @@
 /dts-v1/;
 #include "mmp3.dtsi"
 #include <dt-bindings/gpio/gpio.h>
+#include <dt-bindings/leds/common.h>
 #include <dt-bindings/interrupt-controller/irq.h>
 
 / {
@@ -30,23 +31,37 @@ memory@0 {
 		reg = <0x0 0x80000000>;
 		device_type = "memory";
 	};
+	
+	framebuffer@78000000 {
+		compatible = "simple-framebuffer";
+		//compatible = "marvell,mmp2-framebuffer",
+		//	     "marvell,armada-framebuffer";
+		
+		//size Full-HD in 32bpp times 2 (2 outputs)
+		reg = <0x78000000 (1920 * 1080 * 4 * 2 )>;
+		width = <1920>;
+		height = <1080>;
+		stride = <(1920 * 4)>;
+		format = "a8r8g8b8";
+		clocks = <&soc_clocks MMP2_CLK_DISP0_LCDC>,
+			 <&soc_clocks MMP2_CLK_DISP0>;
+		display = <&dvi1_in>;
+	};
 
 	reserved-memory {
 		#address-cells = <1>;
 		#size-cells = <1>;
 		ranges;
 
-		display_reserved: framebuffer {
-			compatible = "marvell,mmp2-framebuffer",
-				     "marvell,armada-framebuffer";
-			size = <0x04000000>;
-			alignment = <0x04000000>;
-			no-map;
+		framebuffer_region@78000000 {
+		reg = <0x78000000 (1920 * 1080 * 4 * 2)>;
+		no-map;
 		};
 	};
 
 	dvi-connector-0 {
 		compatible = "dvi-connector";
+		lebel = "DVI-I";
 		ddc-i2c-bus = <&twsi5>;
 		hpd-gpios = <&gpio 62 GPIO_ACTIVE_LOW>;
 		digital;
@@ -61,6 +76,7 @@ dvi0_in: endpoint {
 
 	dvi-connector-1 {
 		compatible = "dvi-connector";
+		label = "DVI-D";
 		ddc-i2c-bus = <&twsi6>;
 		hpd-gpios = <&gpio 59 GPIO_ACTIVE_LOW>;
 		digital;
@@ -71,6 +87,17 @@ dvi1_in: endpoint {
 			};
 		};
 	};
+	
+	ec_input_spi: spi {
+		compatible = "spi-gpio";
+		#address-cells = <1>;
+		#size-cells = <0>;
+
+		num-chipselects = <0>;
+		sck-gpios = <&gpio 55 GPIO_ACTIVE_HIGH>;
+		miso-gpios = <&gpio 57 GPIO_ACTIVE_HIGH>;
+		mosi-gpios = <&gpio 58 GPIO_ACTIVE_HIGH>;
+	};
 
 	sound-card {
 		compatible = "audio-graph-card";
@@ -90,6 +117,19 @@ sound-card {
 	};
 };
 
+&ec_input_spi {
+	status = "okay";
+	cs-gpios = <&gpio 56 GPIO_ACTIVE_LOW>;
+
+	power-button@0 {
+		reg = <0>;
+		interrupt-parent = <&gpio>;
+		interrupts = <60 IRQ_TYPE_EDGE_RISING>;
+		compatible = "dell,wyse-ariel-ec-input", "ene,kb3930-input";
+		spi-max-frequency = <33000000>;
+	};
+};
+
 &uart3 {
 	status = "okay";
 };
@@ -157,6 +197,14 @@ vcpu: buck1 {
 			regulator-boot-on;
 			regulator-always-on;
 		};
+
+		vgpu: buck2 {
+			regulator-name = "vdd_1v8_gpu";
+			regulator-min-microvolt = <1800000>;
+			regulator-max-microvolt = <1800000>;
+			regulator-boot-on;
+			regulator-always-on;
+		};
 	};
 };
 
@@ -211,6 +259,9 @@ embedded-controller@58 {
 
 		off-gpios = <&gpio 126 GPIO_ACTIVE_HIGH>,
 			    <&gpio 127 GPIO_ACTIVE_HIGH>;
+		
+
+		
 	};
 };
 
@@ -234,6 +285,10 @@ &hdmi0_out {
 	remote-endpoint = <&dvi1_in>;
 };
 
+&pdma {
+	status = "okay";
+};
+
 &ssp1 {
 	status = "okay";
 	cs-gpios = <&gpio 46 GPIO_ACTIVE_LOW>;
@@ -246,21 +301,6 @@ firmware-flash@0 {
 	};
 };
 
-&ssp2 {
-	status = "okay";
-	cs-gpios = <&gpio 56 GPIO_ACTIVE_LOW>;
-	//pinctrl-names = "default";
-	//pinctrl-0 = <&ssp2_pins>;
-
-	power-button@0 {
-		reg = <0>;
-		interrupt-parent = <&gpio>;
-		interrupts = <60 IRQ_TYPE_EDGE_RISING>;
-		compatible = "dell,wyse-ariel-ec-input", "ene,kb3930-input";
-		spi-max-frequency = <33000000>;
-	};
-};
-
 &asram {
 	status = "okay";
 };
@@ -289,10 +329,59 @@ sspa0_0: endpoint {
 };
 
 &gpu_2d {
-	status = "okay";
+	status = "disabled";
 };
 
 &gpu_3d {
-	status = "okay";
+	status = "disabled";
 };
 
+&pinctrl {
+	lcd_pins: lcd-pins {
+		lcd-fclk-pins {
+			pins = "gpio_74";
+			function = "lcd";
+			slew-rate = <1>;
+			marvell,sleep-output = <0>;
+			// WKE_0;
+		};
+
+		lcd-lclk-pins {
+			pins = "gpio_75";
+			function = "lcd";
+			slew-rate = <1>;
+			marvell,sleep-output = <0>;
+			// WKE_0;
+		};
+
+		lcd-pclk-pins {
+			pins = "gpio_76";
+			function = "lcd";
+			bias-pull-up;
+			slew-rate = <3>;
+			marvell,sleep-output = <0>;
+			// WKE_0;
+		};
+
+		lcd-dena-pins {
+			pins = "gpio_77";
+			function = "lcd";
+			slew-rate = <1>;
+			marvell,sleep-output = <0>;
+			// WKE_0;
+		};
+
+		lcd-data-pins {
+			pins = "gpio_100", "gpio_101", "gpio_78", "gpio_79",
+			       "gpio_80", "gpio_81", "gpio_82", "gpio_83",
+			       "gpio_84", "gpio_85", "gpio_86", "gpio_87",
+			       "gpio_88", "gpio_89", "gpio_90", "gpio_91",
+			       "gpio_92", "gpio_93", "gpio_94", "gpio_95",
+			       "gpio_96", "gpio_97", "gpio_98", "gpio_99";
+			function = "lcd";
+			marvell,sleep-output = <0>;
+			slew-rate = <1>;
+			// WKE_0;
+		};
+	};
+};
diff --git a/arch/arm/boot/dts/marvell/mmp3.dtsi b/arch/arm/boot/dts/marvell/mmp3.dtsi
index 03f987888c01..45d11c45293b 100644
--- a/arch/arm/boot/dts/marvell/mmp3.dtsi
+++ b/arch/arm/boot/dts/marvell/mmp3.dtsi
@@ -55,8 +55,6 @@ lcd0: lcdc@d420b000 {
 					 <&soc_clocks MMP2_CLK_DISP0>,
 					 <&soc_clocks MMP2_CLK_DISP1>,
 					 <&soc_clocks MMP3_CLK_PLL3>;
-				clock-names = "periph", "vctcxo",
-					      "disp0", "disp1", "pll3";
 				status = "disabled";
 
 				ports {
@@ -360,26 +358,30 @@ camera1: camera@d420a800 {
 
 			gpu_3d: gpu@d420d000 {
 				compatible = "vivante,gc";
-				reg = <0xd420d000 0x2000>;
+				reg = <0xd420d000 0x1000>;
 				interrupt-parent = <&gpu_mux>;
 				interrupts = <0>;
 				status = "disabled";
 				clocks = <&soc_clocks MMP3_CLK_GPU_3D>,
+					 <&soc_clocks MMP3_CLK_GPU_BUS>,
 					 <&soc_clocks MMP3_CLK_GPU_BUS>;
-				clock-names = "core", "bus";
-				power-domains = <&soc_clocks MMP2_POWER_DOMAIN_GPU>;
+				clock-names = "core", "bus","shader";
+				//power-domains = <&soc_clocks MMP2_POWER_DOMAIN_GPU>;
+				power-domains = <&soc_clocks 0>;
+				power-domain-names = "gpu";
 			};
 
 			gpu_2d: gpu@d420f000 {
 				compatible = "vivante,gc";
-				reg = <0xd420f000 0x2000>;
+				reg = <0xd420f000 0x1000>;
 				interrupt-parent = <&gpu_mux>;
 				interrupts = <2>;
 				status = "disabled";
 				clocks = <&soc_clocks MMP3_CLK_GPU_2D>,
 					 <&soc_clocks MMP3_CLK_GPU_BUS>;
 				clock-names = "core", "bus";
-				power-domains = <&soc_clocks MMP2_POWER_DOMAIN_GPU>;
+				power-domains = <&soc_clocks 0>;
+				power-domain-names = "gpu";
 			};
 
 			rng@d4292c00 {
@@ -455,7 +457,7 @@ apb@d4000000 {
 			reg = <0xd4000000 0x00200000>;
 			ranges;
 
-			dma-controller@d4000000 {
+			pdma: dma-controller@d4000000 {
 				compatible = "marvell,pdma-1.0";
 				reg = <0xd4000000 0x10000>;
 				interrupts = <GIC_SPI 48 IRQ_TYPE_LEVEL_HIGH>;
-- 
2.52.0

