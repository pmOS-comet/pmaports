From a38d90dab271fd9911cf338e2693fd608744d9f7
From: Lukas F. Hartmann <lukas@mntre.com>
Subject: sdio-improve-wifi-speed
Date:   Tue Nov 12 03:00:14 2024 +0100

diff --git a/arch/arm64/boot/dts/amlogic/meson-g12b-bananapi-cm4.dtsi b/arch/arm64/boot/dts/amlogic/meson-g12b-bananapi-cm4.dtsi
index 5805bc9..144d68b 100644
--- a/arch/arm64/boot/dts/amlogic/meson-g12b-bananapi-cm4.dtsi
+++ b/arch/arm64/boot/dts/amlogic/meson-g12b-bananapi-cm4.dtsi
@@ -31,6 +31,7 @@ sdio_pwrseq: sdio-pwrseq {
 		reset-gpios = <&gpio GPIOAO_6 GPIO_ACTIVE_LOW>;
 		clocks = <&wifi32k>;
 		clock-names = "ext_clock";
+		post-power-on-delay-ms = <200>;
 	};
 
 	emmc_1v8: regulator-emmc-1v8 {
@@ -299,19 +300,24 @@ &sd_emmc_a {
 	#size-cells = <0>;
 
 	bus-width = <4>;
+	cap-sd-highspeed;
+	sd-uhs-sdr50;
 	sd-uhs-sdr104;
-	max-frequency = <50000000>;
+	max-frequency = <100000000>;
 
 	non-removable;
 	disable-wp;
 
+	/* apparently DRAM quirk is not needed on modern A311D chips */
+	/delete-property/ amlogic,dram-access-quirk;
+
 	/* WiFi firmware requires power in suspend */
 	keep-power-in-suspend;
 
 	mmc-pwrseq = <&sdio_pwrseq>;
 
 	vmmc-supply = <&vddao_3v3>;
-	vqmmc-supply = <&vddao_3v3>;
+	vqmmc-supply = <&vddao_1v8>;
 
 	status = "okay";
 
