# Reference: <https://postmarketos.org/devicepkg>
# Maintainer: Dinolek <git@dinolek.me>
pkgname=device-xiaomi-begonia
pkgdesc="Xiaomi Redmi Note 8 Pro"
pkgver=4
pkgrel=0
url="https://postmarketos.org"
license="MIT"
arch="aarch64"
options="!check !archcheck"
depends="
	firmware-xiaomi-begonia-touchscreen
	linux-postmarketos-mediatek-mt6785
	mesa-vulkan-panfrost
	mkbootimg
	postmarketos-base
"
makedepends="android-tools devicepkg-dev dtc"
source="deviceinfo modules-initfs"

build() {
	devicepkg_build $startdir $pkgname

	# begonia bootloader needs empty dtbo, build it and add as recovery_dtbo to final image
	mkdir "$builddir"
	echo '/dts-v1/;/{};' | dtc -I dts -O dtb -o "$builddir/empty.dtb"
	mkdtboimg create "$builddir/empty.dtbo" "$builddir/empty.dtb"
}

package() {
	devicepkg_package $startdir $pkgname

	mkdir -p "$pkgdir/boot"
	install -Dm644 "$builddir/empty.dtbo" \
		"$pkgdir/boot/"
}

sha512sums="
c84f2c8cd0d4203df6bda2cd3c023d5f486c57d02aaf1734afcf4593c0a51972b0a6c2a432e71c1ba26aabb6b837dd1e1af48ca1a4549815ecccceecbe6c6530  deviceinfo
fb17475e434aa5c1c7ee3103ef3dc5bd1d663184764d770f5c4944a2ea1901fc5351296ca5dc8e3dc3bf74aac1718f49b932f8be0b39add770c5851c708482b8  modules-initfs
"
