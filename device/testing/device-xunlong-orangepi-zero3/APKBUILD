# Reference: <https://postmarketos.org/devicepkg>
pkgname=device-xunlong-orangepi-zero3
pkgdesc="Xunlong Orange Pi Zero 3"
pkgver=2
pkgrel=0
url="https://postmarketos.org"
license="MIT"
arch="aarch64"
options="!check !archcheck"
depends="
	linux-postmarketos-allwinner
	postmarketos-base
"
makedepends="devicepkg-dev"
_pmb_select="$pkgname-u-boot-select"
subpackages="
	$pkgname-u-boot-select-sunxi:u_boot_sunxi
	$pkgname-u-boot-select-orangepi-zero3:u_boot_orangepi_zero3
"
source="deviceinfo"

build() {
	devicepkg_build $startdir $pkgname
}

package() {
	depends="$depends $pkgname-u-boot-select"
	devicepkg_package $startdir $pkgname
}

u_boot_sunxi() {
	pkgdesc="Use upstream U-Boot (u-boot-sunxi) (WARNING: does not support 1.5 GB models)"
	depends="u-boot-sunxi"

	provides="$pkgname-u-boot-select"
	provider_priority=1

	mkdir -p $subpkgdir
}

u_boot_orangepi_zero3() {
	pkgdesc="Use downstream U-Boot package specifically for the Orange Pi Zero 3"
	depends="u-boot-xunlong-orangepi-zero3"

	provides="$pkgname-u-boot-select"
	provider_priority=100

	mkdir -p $subpkgdir
}

sha512sums="
ee07bf016014cfdbbbe7e1a4ba51dc640fbc105196f8489f3451f44e1aa5fdca52a537a55b4d1d82330f832480274f4e11340cc910ddf292ec995b20836b756a  deviceinfo
"
