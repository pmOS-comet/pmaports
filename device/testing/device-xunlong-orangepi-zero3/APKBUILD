# Reference: <https://postmarketos.org/devicepkg>
pkgname=device-xunlong-orangepi-zero3
pkgdesc="Xunlong Orange Pi Zero 3"
pkgver=1
pkgrel=0
url="https://postmarketos.org"
license="MIT"
arch="aarch64"
options="!check !archcheck"
depends="
	linux-postmarketos-allwinner
	postmarketos-base
"
makedepends="devicepkg-dev"
_pmb_select="$pkgname-u-boot-select"
subpackages="
	$pkgname-u-boot-select-sunxi:u_boot_sunxi
	$pkgname-u-boot-select-orangepi-zero3:u_boot_orangepi_zero3
"
source="deviceinfo"

build() {
	devicepkg_build $startdir $pkgname
}

package() {
	depends="$depends $pkgname-u-boot-select"
	devicepkg_package $startdir $pkgname
}

u_boot_sunxi() {
	pkgdesc="Use upstream U-Boot (u-boot-sunxi) (WARNING: does not support 1.5 GB models)"
	depends="u-boot-sunxi"

	provides="$pkgname-u-boot-select"
	provider_priority=1

	mkdir -p $subpkgdir
}

u_boot_orangepi_zero3() {
	pkgdesc="Use downstream U-Boot package specifically for the Orange Pi Zero 3"
	depends="u-boot-xunlong-orangepi-zero3"

	provides="$pkgname-u-boot-select"
	provider_priority=100

	mkdir -p $subpkgdir
}

sha512sums="
2d95715655ec9569b071227345bc59eedf129f92fc0b77f0bdaf3e47728be94a3f389193a153a3da3385c96a8c3dcc11b034e98414da0c3f06c9d367f807dd23  deviceinfo
"
