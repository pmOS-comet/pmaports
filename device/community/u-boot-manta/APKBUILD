# Maintainer: Lukas Timmermann <linux@timmermann.space>

pkgname=u-boot-manta
pkgver=2026.01
pkgrel=0
pkgdesc="U-Boot bootloader for the Samsung Manta (Google Nexus 10) Tablet"
url="https://gitlab.com/LaT3St/u-boot"
arch="armv7"
license="GPL-2.0-or-later OFL-1.1 BSD-2-Clause BSD-3-Clause eCos-2.0 IBM-pibs
	ISC LGPL-2.0-only LGPL-2.1-only X11"
makedepends="$depends_dev
	bc
	bison
	dtc
	flex
	openssl-dev
	py3-setuptools
	python3-dev
	swig
	gnutls-dev
	android-tools
	"
options="!check"
source="https://gitlab.com/LaT3St/u-boot/-/archive/lat3st/samsung-manta/u-boot-lat3st-samsung-manta.tar.gz
		update-u-boot
	"
builddir="$srcdir/u-boot-lat3st-samsung-manta"

build() {
	LC_ALL=C date +'#define U_BOOT_DATE "%b %d %C%y"' > include/timestamp_autogenerated.h
	LC_ALL=C date +'#define U_BOOT_TIME "%T"' >> include/timestamp_autogenerated.h

	export BUILD_DIR="$builddir"/build

	mkdir -p "$BUILD_DIR"
	make O="$BUILD_DIR" HOSTCC=gcc ARCH=arm manta_defconfig
	make O="$BUILD_DIR" HOSTCC=gcc ARCH=arm all
	sha512sum -b "$BUILD_DIR/u-boot.bin" > "$BUILD_DIR/u-boot.bin.sha512"
}

package() {
	install -D -m644 "build/u-boot.bin" \
		"$pkgdir/usr/share/u-boot/samsung-manta/u-boot.bin"
	install -D -m644 "build/u-boot.bin.sha512" \
		"$pkgdir/usr/share/u-boot/samsung-manta/u-boot.bin.sha512"

	install -D -m 755 "$srcdir"/update-u-boot "$pkgdir"/usr/sbin/update-u-boot
}

sha512sums="
aa47486537fa9f8b16f50919ae2f16a2556f1ac07acc24943a9798b35236ecc7de77c8b48aa07179e07422eda1435ed701d4a1e65b8993edc1c97f809efe72a3  u-boot-lat3st-samsung-manta.tar.gz
654c3fe5ed9eb078f97b990d2743dd875fb3d395bcbbb8a3082fd8e73bdf1842f8919f7b58a81c4446f00739e935d31cfabb59086d255c5d978e0f7a0bc3c3d8  update-u-boot
"
